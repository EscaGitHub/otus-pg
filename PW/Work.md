# Подключение и настройка балансировщика нагрузки и мониторинга PostgreSQL

## Введение
Создание соединения с базой данных PostgreSQL для выполнения запросов обходится довольно дорого. Накладные расходы 
составляют около 1.3MB - 2MB памяти на одно соединение. Так же каждый раз нужны ресурсы для созданий [новых процессов
на сервере БД](https://www.postgresql.org/docs/current/connect-estab.html). Каждый клиент подключается к новому процессу,
которыми управляет postmaster. Всякий раз, когда он обнаруживает запрос на соединение, он запускает новый внутренний 
процесс. При большом количестве клиентских соединений БД создает множество процессов и управляет разделяемыми 
структурами данных. Из-за этого может возникнуть нехватка вычислительных ресурсов, которая сказывается на производительности.

Чтобы решить проблему нехватки ресурсов, перед кластером PostgreSQL часто размещают менеджеры подключений (connection 
pooler). Менеджеры подключений управляют соединениями, позволяя подключиться к БД большому числу клиентов без деградации
производительности. Между менеджером подключений и СУБД поддерживается относительно небольшое количество соединений, 
которые можно переиспользовать. После отключения клиента соединение возвращается в пул и может быть повторно использовано
тем же самым или новым клиентом.

## Виды

### [Pgpool-II](https://www.pgpool.net/)
### [Pgbouncer](https://www.pgbouncer.org/)
### [Odyssey](https://yandex.ru/dev/odyssey/)

## Источники
- https://habr.com/ru/articles/499404/ - Управление нагрузкой на PostgreSQL, когда одного сервера уже мало. Андрей Сальников
- https://yandex.cloud/ru/docs/managed-postgresql/concepts/pooling?utm_referrer=https%3A%2F%2Fwww.google.com%2F - Управление соединениями
- https://stackoverflow.blog/2020/10/14/improve-database-performance-with-connection-pooling/ - Improve database 
performance with connection pooling. October 2020.